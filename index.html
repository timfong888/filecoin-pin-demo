<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filecoin Pin CLI Walkthrough</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #0090ff;
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 3px solid #0090ff;
            padding-bottom: 10px;
        }

        h2 {
            color: #0090ff;
            font-size: 2em;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }

        h3 {
            color: #333;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .update-time {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 30px;
        }

        blockquote {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            color: #856404;
        }

        .fast-start {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
        }

        .fast-start h2 {
            margin-top: 0;
            color: #28a745;
            border-bottom: 2px solid #28a745;
        }

        .fast-start-step {
            margin: 30px 0;
        }

        .fast-start-step h3 {
            color: #28a745;
            margin-top: 20px;
        }

        .screenshot {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .screenshot img {
            width: 100%;
            height: auto;
            display: block;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.9em;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre code {
            background: none;
            padding: 0;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        p {
            margin: 15px 0;
        }

        strong {
            color: #000;
            font-weight: 600;
        }

        .separator {
            border: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #0090ff, transparent);
            margin: 40px 0;
        }

        .checkmark {
            color: #28a745;
            font-size: 1.2em;
        }

        .key-value {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #0090ff;
            margin: 15px 0;
        }

        .key-value strong {
            color: #0090ff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            h2 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Filecoin Pin CLI Walkthrough</h1>
        <p class="update-time">Update: 10.14.2025 12:00 PM PDT</p>
        <p class="subtitle"><strong>How to use the Filecoin Pin CLI to store IPFS data on Filecoin</strong></p>

        <blockquote style="background: #e3f2fd; border-left: 4px solid #0090ff; color: #1565c0;">
            <strong>📦 Stored on IPFS + Filecoin</strong><br>
            This page is automatically uploaded to decentralized storage. Access via root CID without specifying filename:<br>
            • <code>https://ipfs.io/ipfs/&lt;CID&gt;/</code> (auto-serves index.html)<br>
            • <code>https://&lt;CID&gt;.ipfs.dweb.link/</code> (auto-serves index.html)<br>
            Check the latest <a href="logs/">upload logs</a> for the current root CID.
        </blockquote>

        <div class="fast-start">
            <h2>Get Started Now</h2>

            <div class="fast-start-step">
                <h3>1. Setup Payments</h3>
                <p>Configure permissions for automatic payment handling:</p>
                <div class="screenshot">
                    <img src="video/screenshots/fast-start-01-setup-payments.png" alt="Setup Payments">
                </div>
            </div>

            <div class="fast-start-step">
                <h3>2. Upload Data</h3>
                <p>Upload your file with automatic funding:</p>
                <div class="screenshot">
                    <img src="video/screenshots/fast-start-02-upload-data.png" alt="Upload Data">
                </div>
            </div>

            <div class="fast-start-step">
                <h3>3. Retrieve over an IPFS Gateway</h3>
                <p>Retrieve your data using the IPFS gateway:</p>
                <div class="screenshot">
                    <img src="video/screenshots/fast-start-03-get-data.png" alt="Get Data">
                </div>
            </div>

            <div class="fast-start-step">
                <h3>4. Prove Storage</h3>
                <p>Verify your data is stored with cryptographic proofs:</p>
                <div class="screenshot">
                    <img src="video/screenshots/fast-start-04-prove-storage.png" alt="Prove Storage">
                </div>
            </div>
        </div>

        <hr class="separator">

        <blockquote>
            <strong>NOTE!</strong> For demo purposes, I have created a THROWAWAY PRIVATE KEY. <strong>NEVER USE YOUR PRIVATE KEY IN A REPOSITORY OR EXPOSE IT</strong>.
            The repo references using your private key LOCALLY as an ENV VARIABLE.
            When you create a GITHUB ACTION, use GITHUB SECRETS to store your private key.
        </blockquote>

        <h2>Who is this for</h2>
        <ol>
            <li>Existing IPFS developers who want to use Filecoin to persist their data</li>
            <li>Technical users who want to use GitHub Actions to automate deployment of IPFS Files onto decentralized storage</li>
            <li>Agent builders that want to store their agent cards and validation materials on Filecoin for cryptographic proof of storage</li>
        </ol>

        <hr class="separator">

        <h2>Prerequisites</h2>

        <h3>Install Required Tools</h3>
        <pre><code># Install Node.js 22+ (required for filecoin-pin)
nvm install 22
nvm use 22

# Install filecoin-pin globally
npm install -g filecoin-pin

# Install ipfs-car (for CAR file operations)
npm install -g @ipld/car-cli

# Install GitHub CLI
brew install gh  # macOS
# or
sudo apt install gh  # Ubuntu/Debian

# Install Foundry (for wallet operations)
curl -L https://foundry.paradigm.xyz | bash
# Then run this in a new terminal:
foundryup</code></pre>

        <h3>Verify Installation</h3>
        <pre><code>filecoin-pin --version
# Expected: filecoin-pin v0.6.0 (or later)

gh --version
# Expected: gh version 2.40.0 (or later)

node --version
# Expected: v22.x.x or higher

cast --version
# Expected: cast 0.2.0 (or later)</code></pre>

        <hr class="separator">

        <h2>Part 0: Wallet Setup from Scratch</h2>

        <blockquote>
            <strong>Note:</strong> The <code>filecoin-pin</code> CLI expects a <code>PRIVATE_KEY</code> environment variable. This section shows initial setup.
        </blockquote>

        <h3>Step 0.1: Generate a New Wallet</h3>
        <p>Generate wallet using Foundry:</p>
        <pre><code>cast wallet new</code></pre>
        <p>Save the private key and wallet address.</p>

        <h3>Step 0.2: Get Testnet FIL</h3>
        <p>Get 100 tFIL from ChainSafe faucet (requires browser):</p>
        <pre><code>open "https://faucet.calibnet.chainsafe-fil.io/funds.html"</code></pre>

        <h3>Step 0.3: Get USDFC Stablecoin</h3>
        <ol>
            <li><a href="https://docs.filecoin.io/basics/assets/metamask-setup">Setup MetaMask with Filecoin Calibration</a> (1-click import available)</li>
            <li>Import your private key to MetaMask</li>
            <li>Visit <a href="https://stg.usdfc.net">USDFC minting app</a></li>
            <li>Mint 200 USDFC using 98 FIL collateral</li>
        </ol>
        <p>Final state: ~2 tFIL (gas) + 200 USDFC (storage payments)</p>

        <h3>Step 0.4: Create Environment File</h3>
        <blockquote>
            I put my private key on this repo for DEMO purposes. It is a TESTNET KEY. <strong>NEVER USE YOUR PRIVATE KEY IN A REPOSITORY OR EXPOSE IT</strong>.
        </blockquote>
        <p>Save your credentials <strong>locally</strong> for easy reuse:</p>
        <pre><code>cat > ~/.filecoin-pin-env << 'EOF'
export PRIVATE_KEY="0x8eef...c414"
export WALLET_ADDRESS="0x5a0c7D45C3834E4eB18c26C60932B757A43B7B0B"
export RPC_URL="https://api.calibration.node.glif.io/rpc/v1"
EOF

# Load variables
source ~/.filecoin-pin-env

# Verify
echo "Wallet: $WALLET_ADDRESS"
echo "Private Key: ${PRIVATE_KEY:0:10}..."
echo "RPC URL: $RPC_URL"</code></pre>

        <hr class="separator">

        <h2>Step 1: Setup Payments</h2>

        <p>All commands in this section use the environment variables set in Part 0 (Step 0.4). If you're starting a new terminal session, reload them:</p>
        <pre><code>source ~/.filecoin-pin-env</code></pre>

        <blockquote>
            <strong>Note:</strong> These commands work directly without running a server/daemon. The <code>PRIVATE_KEY</code> and <code>RPC_URL</code> environment variables must be set.
        </blockquote>

        <p>Configure payment approvals (permissions only - deposits handled automatically with <code>--auto-fund</code>):</p>
        <pre><code>filecoin-pin payments setup --auto</code></pre>

        <blockquote>
            <strong>What <code>--auto</code> does:</strong> Configures WarmStorage contract permissions automatically. No deposit required at this step - use <code>--auto-fund</code> when uploading to handle deposits automatically.
        </blockquote>

        <hr class="separator">

        <h2>Step 2: Upload Data</h2>

        <p>Use <code>--auto-fund</code> flag to automatically handle payment deposits (v0.7.0+).</p>

        <h3>Upload a file:</h3>
        <pre><code># Create test file
echo "Hello Filecoin from CLI!" > demo.txt

# Upload to Filecoin
filecoin-pin add demo.txt</code></pre>

        <div class="key-value">
            <p><strong>Key values explained:</strong></p>
            <ul>
                <li><strong>Root CID:</strong> <code>bafybeibh422kjvgfmymx6nr7jandwngrown6ywomk4vplayl4de2x553t4</code> - IPFS content identifier for your data</li>
                <li><strong>Piece CID:</strong> <code>bafkzcibcfab4grpgq6e6rva4kfuxfcvibdzx3kn2jdw6q3zqgwt5cou7j6k4wfq</code> - Filecoin piece commitment (cryptographic proof)</li>
                <li><strong>Piece ID:</strong> <code>0</code> - Reference within the data set</li>
                <li><strong>Data Set ID:</strong> <code>325</code> - On-chain data set containing your upload</li>
                <li><strong>Transaction:</strong> <code>0xc85e49d2ed745cc8c5d7115e7c45a1243ec25da7e73e224a744887783afea42b</code> - Blockchain confirmation hash</li>
                <li><strong>Direct Download URL:</strong> Direct link to retrieve your data from the storage provider</li>
            </ul>
        </div>

        <p class="checkmark">✅ <strong>Your file is now stored on Filecoin with ongoing proof of possession!</strong></p>

        <hr class="separator">

        <h3>Step 4b: Upload Directory</h3>
        <p>Package multiple files into a single CAR:</p>
        <pre><code># Create test directory
mkdir my-data
echo "File 1" > my-data/file1.txt
echo "File 2" > my-data/file2.txt
echo "File 3" > my-data/file3.txt

# Upload entire directory with auto-funding
filecoin-pin add --auto-fund my-data/</code></pre>

        <div class="key-value">
            <p><strong>Key details:</strong></p>
            <ul>
                <li><strong>Root CID:</strong> <code>bafybeig27btater5fpt3l67gbme3sebqk3ynwdhlbrbuk3q7espiyplan4</code> - IPFS directory structure</li>
                <li><strong>Size:</strong> 433.0 B - Includes all files plus directory metadata</li>
                <li><strong>Piece ID:</strong> <code>1</code> - Second piece in the same Data Set ID 325</li>
                <li><strong>Data Set ID:</strong> <code>325</code> - Same data set as the single file upload (multiple pieces grouped together)</li>
            </ul>
        </div>

        <blockquote>
            💡 <strong>Note:</strong> Multiple uploads to the same payment configuration are grouped into the same Data Set, with each upload assigned a unique Piece ID.
        </blockquote>

        <hr class="separator">

        <h2>Step 5: Prove Storage</h2>

        <p>Get detailed information about a specific data set (this queries the blockchain directly) that includes proofs:</p>
        <pre><code>filecoin-pin data-set 325</code></pre>

        <h3>Expected Output:</h3>
        <pre><code>Filecoin Onchain Cloud Data Sets

━━━ Data Sets ━━━

Data Set #325 • live
  Managed by Warm Storage: yes
  CDN add-on: disabled
  Pieces stored: 2
  Leaf count: 21
  Total size: 672.0 B
  Client data set ID: 0
  PDP rail ID: 631
  CDN rail ID: none
  Cache-miss rail ID: none
  Payer: 0x5a0c7D45C3834E4eB18c26C60932B757A43B7B0B
  Payee: 0xa3971A7234a3379A1813d9867B531e7EeB20ae07
  Service provider: 0xa3971A7234a3379A1813d9867B531e7EeB20ae07
  Provider: ezpdpz-calib (ID 3)
  Commission: 0.00%

Provider Service
  Service URL: https://calib.ezpdpz.net
  Min piece size: 1.0 KB
  Max piece size: 32.0 GB
  Storage price: < 0.0001 USDFC/TiB/month
  Min proving period: 30 epochs
  Location: unknown
  Payment token: USDFC (native)

Metadata
    source: filecoin-pin
    withIPFSIndexing: (empty)

Pieces
  Total pieces: 2
  Unique CommPs: 2
  Unique root CIDs: 2

  #0
    CommP: bafkzcibcfab4grpgq6e6rva4kfuxfcvibdzx3kn2jdw6q3zqgwt5cou7j6k4wfq
    Root CID: bafybeibh422kjvgfmymx6nr7jandwngrown6ywomk4vplayl4de2x553t4
  #1
    CommP: bafkzcibcjmcnyio2ocxhmtq34uh5ct425xzpnor532zku7tjvqf5toodbxtsqhi
    Root CID: bafybeig27btater5fpt3l67gbme3sebqk3ynwdhlbrbuk3q7espiyplan4
Data set inspection complete</code></pre>

        <div class="key-value">
            <p><strong>Key information:</strong></p>

            <h4>Data Set Status:</h4>
            <ul>
                <li><strong>live</strong> - Data set is active with ongoing PDP proofs</li>
                <li><strong>Pieces stored: 2</strong> - Our demo.txt (#0) and my-data/ directory (#1)</li>
                <li><strong>Leaf count: 21</strong> - Total Merkle tree leaves across all pieces</li>
                <li><strong>Total size: 672.0 B</strong> - Combined size of both pieces</li>
            </ul>

            <h4>Payment Rails:</h4>
            <ul>
                <li><strong>PDP rail ID: 631</strong> - Active payment rail for storage proofs</li>
                <li><strong>Payer/Payee</strong> - Payment flows from your wallet to the provider</li>
                <li><strong>Commission: 0.00%</strong> - No commission on this testnet provider</li>
            </ul>

            <h4>Provider Details:</h4>
            <ul>
                <li><strong>Service URL:</strong> Direct access to download pieces</li>
                <li><strong>Storage price:</strong> &lt; 0.0001 USDFC/TiB/month (very low for testnet)</li>
                <li><strong>Min proving period: 30 epochs</strong> - Proofs submitted every 15 minutes</li>
            </ul>

            <h4>Pieces:</h4>
            <ul>
                <li>Each piece shows its CommP (Filecoin piece CID) and Root CID (IPFS content ID)</li>
                <li>Piece #0 = demo.txt (our single file upload)</li>
                <li>Piece #1 = my-data/ (our directory upload)</li>
            </ul>
        </div>

        <blockquote>
            💡 <strong>Note:</strong> This command queries the smart contracts on-chain to retrieve all data set information. The data shown is live blockchain state, not cached data.
        </blockquote>

        <hr class="separator">

        <h3>Links</h3>
        <ul>
            <li>FAQ: <a href="context/projects/filecoin-pinning/demo-walkthrough/10-13-faq-output.md">10-13-faq-output.md</a></li>
            <li><a href="https://docs.filecoin.io/builder-cookbook/filecoin-onchain-cloud/filecoin-pin">Filecoin Pin CLI Docs</a></li>
            <li><a href="https://github.com/filecoin-project/filecoin-pin">Filecoin Pin CLI Repo</a></li>
            <li><a href="https://github.com/filecoin-project/filecoin-pin-website">Filecoin Pin dApp Repo</a></li>
            <li><a href="https://github.com/FilOzone/synapse-sdk">Synapse SDK</a></li>
            <li><a href="https://usdfc.io/">USDFC documentation</a></li>
        </ul>

    </div>
</body>
</html>
